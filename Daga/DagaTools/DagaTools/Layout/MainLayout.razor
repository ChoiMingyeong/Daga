@inherits LayoutComponentBase

<MudThemeProvider Theme="theme" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="0" Dense="true">
        <MudElement HtmlTag="a" href="">
            <MudStack Row AlignItems="AlignItems.Center" Spacing="0">
                <MudImage Src="daga-icon-32.png"/>
                <MudText Typo="Typo.h6" Style="color: white; font-weight: bold;">DAGA</MudText>
            </MudStack>
        </MudElement>
        <MudSpacer />
        <MudItem hidden="@(null == AuthService.Account)">
            <MudIconButton Icon="@Icons.Material.Filled.AccountCircle" Color="Color.Inherit" OnClick="@OnProfilIconButtonClicked" />
            <MudPopover Open="@profilePopoverOpen" AnchorOrigin="Origin.BottomLeft" TransformOrigin="Origin.TopCenter" RelativeWidth="DropdownWidth.Adaptive">
                <MudButton OnClick="OnLogoutButtonClicked">로그아웃</MudButton>
            </MudPopover>
        </MudItem>
        <MudItem hidden="@(null != AuthService.Account)">
            <MudElement HtmlTag="a" Style="color: white" href="login">Login</MudElement>
        </MudItem>
    </MudAppBar>
    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.Medium" Style="margin-top: 50px">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    private MudTheme theme = new()
        {
            PaletteLight = new()
            {
                AppbarBackground = Colors.Gray.Darken3,
                AppbarText = Colors.Shades.White,
                Primary = Colors.Indigo.Darken3,
            },
        };
    private bool profilePopoverOpen = false;

    protected override async Task OnInitializedAsync()
    {
        await AuthService.GetAuthenticationStateAsync();
    }

    private void OnProfilIconButtonClicked()
    {
        profilePopoverOpen = !profilePopoverOpen;
    }

    private async Task OnLogoutButtonClicked()
    {
        await AuthService.LogoutAsync();
        NavigationManager.NavigateTo("login", forceLoad: true);
    }
}