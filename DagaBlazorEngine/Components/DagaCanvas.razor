@using Microsoft.JSInterop
@using System.Numerics

<canvas @ref="_canvasRef" width="@CanvasWidth" height="@CanvasHeight" />

@code {
    private ElementReference _canvasRef;
    private DotNetObjectReference<DagaCanvas>? _dotNetRef;
    private IJSObjectReference? _screenSizeModule;

    public int CanvasWidth { get; private set; } = 800;
    public int CanvasHeight { get; private set; } = 600;

    [Inject]
    private IJSRuntime JSRuntime { get; set; } = default!;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _dotNetRef = DotNetObjectReference.Create(this);
            _screenSizeModule = await JSRuntime.InvokeAsync<IJSObjectReference>(
                "import", "/_content/DagaBlazorEngine/js/screenHelper.js");
            await _screenSizeModule.InvokeVoidAsync("resizeCallback", _dotNetRef);
        }
    }

    [JSInvokable]
    public async Task OnResize(ScreenSize screenSize)
    {
        CanvasWidth = (int)screenSize.X;
        CanvasHeight = (int)screenSize.Y;

        await UpdateAsync();
        await InvokeAsync(StateHasChanged);
    }

    public async Task UpdateAsync()
    {
        // 캔버스 다시 그리기 로직
    }

    public async ValueTask DisposeAsync()
    {
        _dotNetRef?.Dispose();
        if (_screenSizeModule is not null)
            await _screenSizeModule.DisposeAsync();
    }

    public class ScreenSize
    {
        public float X { get; set; }
        public float Y { get; set; }
    }
}
